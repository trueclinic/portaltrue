{% extends 'base_app.html' %}
{% block title %}Exames Â· TrueClinic{% endblock %}
{% block nav_active_exames %}active{% endblock %}
{% block content %}
  <div class="card" style="margin-bottom:12px;display:flex;gap:8px;align-items:center;justify-content:space-between">
    <h2 style="margin:0">Exames</h2>
    <div style="display:flex;gap:8px;align-items:center">
      <a class="btn btn-secondary" href="?">Limpar</a>
      {% if request.user.is_staff %}
        <a class="btn" href="{% url 'consulta:criar' %}">Novo exame</a>
      {% endif %}
    </div>
  </div>
  <div class="kpi-grid" style="margin-bottom:8px">
    <div class="kpi-card"><div class="ico">ðŸ“…</div><div class="meta"><div class="val">{{ kpi_exames.hoje }}</div><div class="lbl">Hoje</div></div></div>
    <div class="kpi-card"><div class="ico">ðŸ“ˆ</div><div class="meta"><div class="val">{{ kpi_exames.semana }}</div><div class="lbl">Esta semana</div></div></div>
    <div class="kpi-card"><div class="ico">ðŸ§ª</div><div class="meta"><div class="val">{{ kpi_exames.total }}</div><div class="lbl">Total</div></div></div>
  </div>

  <form method="get" class="card" style="margin-bottom:12px;display:flex;gap:10px;align-items:flex-end;flex-wrap:wrap">
    <div>
      <label>Nome (exame ou sinistrado)</label>
      <input type="text" name="nome" value="{{ f_nome }}" placeholder="ex.: RX ou JoÃ£o" />
    </div>
    <div>
      <label>NIF</label>
      <input type="text" name="nif" value="{{ f_nif }}" placeholder="ex.: 123" />
    </div>
    <div>
      <label>Data</label>
      <input type="date" name="data" value="{{ f_data }}" />
    </div>
    <button class="btn" type="submit">Filtrar</button>
  </form>

  <table class="table">
    <thead>
      <tr><th>Sinistrado</th><th>Data</th><th>Exame</th><th>NIF</th><th>Caixa</th></tr>
    </thead>
    <tbody>
    {% for e in exames %}
      <tr>
        <td><a href="{% url 'consulta:detalhe' e.id %}">{{ e.nome_sinistrado.nome_sinistrado }}</a></td>
        <td>{{ e.data_exame }}</td>
        <td>{{ e.nome_exame.nome_exame }}</td>
        <td>{{ e.nome_sinistrado.numero_nif }}</td>
        <td>{{ e.caixa }}</td>
      </tr>
    {% empty %}
      <tr><td colspan="6">Sem registos.</td></tr>
    {% endfor %}
    </tbody>
  </table>

  {% if paginator.num_pages > 1 %}
    <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
      {% if page_obj.has_previous %}
        <a class="btn btn-secondary" href="?page={{ page_obj.previous_page_number }}&nome={{ f_nome }}&nif={{ f_nif }}&data={{ f_data }}">Anterior</a>
      {% endif %}
      <span>PÃ¡gina {{ page_obj.number }} de {{ paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a class="btn btn-secondary" href="?page={{ page_obj.next_page_number }}&nome={{ f_nome }}&nif={{ f_nif }}&data={{ f_data }}">Seguinte</a>
      {% endif %}
    </div>
  {% endif %}
{% endblock %}


